相比 Vue 2，Vue 3 的优势是什么，以及 Vue 3 到底有哪些新特性值得我们学习。



## Vue2的核心模块和历史遗留问题

Vue2是一个响应式驱动的、内置虚拟DOM、组件化、用在浏览器开发，并且有一个运行时把这些模块很好地管理起来的框架。

![vue2](.\img\vue2.webp)

常见缺陷：

1. 首先从开发维护的角度看，Vue 2 是使用 Flow.js 来做类型校验。但现在 Flow.js 已经停止维护了，整个社区都在全面使用 TypeScript 来构建基础库，Vue 团队也不例外。
2. 然后从社区的二次开发难度来说，Vue 2 内部运行时，是直接执行浏览器 API 的。但这样就会在 Vue 2 的跨端方案（比如：从浏览器到小程序环境）中带来问题
3. 基于Object.defineProperty()实现的数据劫持方案存在很多缺陷：比如：删除数据就无法监听，需要 $delete 等 API 辅助才能监听到。对不存在属性也无法拦截。
4. Option API 在组织代码较多组件的时候不易维护。对于 Option API 来说，所有的 methods、computed 都在一个对象里配置，这对小应用来说还好。但代码超过 300 行的时候，新增或者修改一个功能，就需要不停地在 data，methods 里跳转写代码，我称之为上下反复横跳。



## Vue3新特性

Vue3就是继承了Vue2具有的响应式、虚拟DOM，组件化等所有优秀的特点，并且全部重新设计，解决了这些历史包袱的新框架，是一个拥抱未来的前端框架。

### RFC(request for commonts)机制

“RFC”（征求意见）流程旨在为新功能进入框架提供一致且受控的路径。

github仓库地址: https://github.com/vuejs/rfcs

该特性和代码无关，而是Vue团队开发的工作方式。

### 响应式系统

Vue3使用`Proxy`实现响应式，解决了Vue基于`Object.defineProperty()`的问题。虽然Proxy拦截数据，但不关系数据的具体属性，统一都拦截了。而且Proxy还可以监听更多的数据格式，比如`Set`、`Map`，这是Vue2做不到的。

### 自定义渲染器

Vue 2 内部所有的模块都是揉在一起的，这样做会导致不好扩展的问题。Vue 3 是怎么解决这个问题的呢？那就是拆包，使用最近流行的 monorepo 管理方式，响应式、编译和运行时全部独立了

![vue3](.\img\vue3.webp)

**在 Vue 3 的组织架构中，响应式独立了出来。**而 Vue 2 的响应式只服务于 Vue，Vue 3 的响应式就和 Vue 解耦了，你甚至可以在 Node.js 和 React 中使用响应式。

渲染的逻辑也拆成了**平台无关渲染逻辑**和**浏览器渲染 API** 两部分 。（解决跨端问题）

### 全部模块使用 TypeScript 重构

类型系统带来了更方便的提示，并且让我们的代码能够更健壮。

### Composition API 组合语法

Composition API也叫组合式API。



Options API 的写法有几个很严重的问题：

- 由于所有数据都挂载在 this 之上，因而 Options API 的写法对 TypeScript 的类型推导很不友好，并且这样也不好做 Tree-shaking 清理代码。
- 新增功能基本都得修改 data、method 等配置，并且代码上 300 行之后，会经常上下反复横跳，开发很痛苦。
- 代码不好复用，Vue 2 的组件很难抽离通用逻辑，只能使用 mixin，还会带来命名冲突的问题。



我们使用 Composition API 后，虽然看起来烦琐了一些，但是带来了诸多好处：

- 所有 API 都是 import 引入的。用到的功能都 import 进来，对 Tree-shaking 很友好
- 不再上下反复横跳，我们可以把一个功能模块的 methods、data 都放在一起书写，维护更轻松。
- 代码方便复用，可以把一个功能所有的 methods、data 封装在一个独立的函数里，复用代码非常容易。
- Composotion API 新增的 return 等语句，在实际项目中使用`<script setup>`特性可以清除， 我们后续项目中都会用到这样的操作。

### 新的组件

Vue 3 还内置了 Fragment、Teleport 和 Suspense 三个新组件。

- Fragment: Vue 3 组件不再要求有一个唯一的根节点，清除了很多无用的占位 div。
- Teleport: 允许组件渲染在别的元素内，主要开发弹窗组件的时候特别有用。
- Suspense: 异步组件，更方便开发有异步请求的组件。

### 新一代工程化工具 Vite

**Vite 主要提升的是开发的体验**，Webpack 等工程化工具的原理，就是根据你的 import 依赖逻辑，形成一个依赖图，然后调用对应的处理工具，把整个项目打包后，放在内存里再启动调试。

由于要预打包，所以复杂项目的开发，启动调试环境需要 3 分钟都很常见，Vite 就是为了解决这个时间资源的消耗问题出现的。

![webpack原理](.\img\webpack原理.webp)

现代浏览器已经默认支持了 ES6 的 import 语法，Vite 就是基于这个原理来实现的。具体来说，在调试环境下，我们不需要全部预打包，只是把你首页依赖的文件，依次通过网络请求去获取，整个开发体验得到巨大提升，做到了复杂项目的秒级调试和热更新。

![vite原理](.\img\vite原理.webp)